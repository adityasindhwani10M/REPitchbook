<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Match</title>
    <style>
        :root {
            /* Matte Green Theme (Matching Broker App) */
            --primary: #557C55;
            --primary-dark: #3E5E3E;
            --bg-color: #F2F8F2;
            --card-bg: #ffffff;
            --text-main: #2F4F2F;
            --text-muted: #6B8C6B;
            --red: #ef4444;
            --border: #A4C3A2;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        
        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* Nav Bar */
        nav {
            background: var(--card-bg);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); letter-spacing: -0.5px; }
        .filter-btn {
            background: none; border: 1px solid var(--border);
            padding: 0.5rem 1rem; border-radius: 20px;
            color: var(--primary); font-weight: 600; cursor: pointer;
            transition: 0.2s;
        }
        .filter-btn:hover { background: var(--bg-color); }

        /* Main Card Container */
        .card-stack {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .property-card {
            position: absolute;
            width: 100%;
            max-width: 400px;
            height: 65vh;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(85, 124, 85, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, opacity 0.3s ease;
            border: 1px solid var(--border);
        }

        .card-image {
            height: 55%;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .price-badge {
            position: absolute;
            bottom: 1rem; left: 1rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-weight: 700;
        }
        
        .verified-badge {
            position: absolute;
            top: 1rem; right: 1rem;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .card-details {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .prop-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 0.25rem; }
        .prop-loc { color: var(--text-muted); font-size: 0.95rem; display: flex; align-items: center; gap: 0.25rem; }
        
        .prop-tags { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .tag { 
            background: #F2F8F2; color: var(--primary-dark); 
            padding: 0.25rem 0.75rem; border-radius: 6px; 
            font-size: 0.8rem; font-weight: 600; 
        }

        /* Action Buttons */
        .actions {
            height: 100px;
            display: flex;
            justify-content: center;
            gap: 2rem;
            align-items: center;
            padding-bottom: 1rem;
        }

        .action-btn {
            width: 60px; height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.95); }

        .btn-skip { background: white; color: var(--red); border: 2px solid var(--red); }
        .btn-like { background: var(--primary); color: white; border: 2px solid var(--primary); }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center; align-items: center;
            z-index: 100;
        }
        
        .modal {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            width: 90%; max-width: 350px;
            text-align: center;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .contact-box {
            background: #F2F8F2;
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border: 1px dashed var(--primary);
        }
        
        .contact-number { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-top: 0.5rem; display: block;}

        .empty-state {
            text-align: center; color: var(--text-muted);
            display: none;
        }

        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        
        /* Filter Drawer */
        .filters {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 50;
            transform: translateY(100%);
            transition: transform 0.3s;
            padding: 1.5rem;
            overflow-y: auto;
        }
        .filters.open { transform: translateY(0); }
        
        .filter-section { margin-bottom: 1.5rem; border-bottom: 1px dashed var(--border); padding-bottom: 1rem; }
        .filter-section:last-of-type { border-bottom: none; }
        
        .filter-label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: var(--text-main); font-size: 0.9rem; }
        
        .input-group { display: flex; gap: 0.5rem; }
        .input-group input, .input-group select { 
            flex: 1; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; font-size: 0.9rem; 
        }

        /* Checkbox Grid */
        .checkbox-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        .check-pill { 
            display: block; position: relative; cursor: pointer; 
        }
        .check-pill input { position: absolute; opacity: 0; }
        .check-pill span { 
            display: block; padding: 0.5rem; text-align: center; border: 1px solid var(--border); 
            border-radius: 6px; font-size: 0.85rem; color: var(--text-muted); transition: 0.2s;
        }
        .check-pill input:checked + span { 
            background: var(--primary); color: white; border-color: var(--primary); 
        }

        .hidden { display: none; }

    </style>
</head>
<body>

<nav>
    <div class="logo">PropMatch</div>
    <button class="filter-btn" onclick="toggleFilters()">Filters</button>
</nav>

<div class="card-stack" id="stack">
    <div class="empty-state" id="emptyState">
        <h3>No more properties!</h3>
        <p>Try adjusting your filters.</p>
        <button onclick="resetFilters()" class="filter-btn" style="margin-top:1rem;">Reset Filters</button>
    </div>
</div>

<div class="actions">
    <button class="action-btn btn-skip" onclick="swipe('left')">‚úï</button>
    <button class="action-btn btn-like" onclick="swipe('right')">‚ô•</button>
</div>

<!-- Match Modal -->
<div class="modal-overlay" id="matchModal">
    <div class="modal">
        <h2 style="color: var(--primary);">It's a Match!</h2>
        <p style="color: var(--text-muted); margin-top: 0.5rem;">You are interested in this property.</p>
        
        <div class="contact-box">
            <small>Contact <span id="contactType">Broker</span></small>
            <span class="contact-number" id="contactNumber">--</span>
        </div>

        <button class="filter-btn" style="background:var(--primary); color:white; width:100%;" onclick="closeModal()">Keep Browsing</button>
    </div>
</div>

<!-- Filters Panel -->
<div class="filters" id="filterPanel">
    <div style="display:flex; justify-content:space-between; margin-bottom:1.5rem; align-items:center;">
        <h2 style="color:var(--primary);">Refine Search</h2>
        <button class="filter-btn" onclick="toggleFilters()" style="border:none;">Close</button>
    </div>
    
    <!-- 1. Type & Location -->
    <div class="filter-section">
        <label class="filter-label">What are you looking for?</label>
        <select id="filterType" onchange="toggleFilterSections()" style="width:100%; padding:0.8rem; border:1px solid var(--border); border-radius:8px; margin-bottom: 0.5rem;">
            <option value="All">All Property Types</option>
            <option value="Built">Apartment / House</option>
            <option value="Land">Land / Plot</option>
        </select>
        <input type="text" id="filterLoc" placeholder="Search Location (e.g. Whitefield)" style="width:100%; padding:0.8rem; border:1px solid var(--border); border-radius:8px;">
    </div>

    <!-- 2. Price Range -->
    <div class="filter-section">
        <label class="filter-label">Budget (‚Çπ)</label>
        <div class="input-group">
            <input type="number" id="priceMin" placeholder="Min (Lakhs)">
            <input type="number" id="priceMax" placeholder="Max (Lakhs)">
        </div>
        <small style="color:var(--text-muted); display:block; margin-top:0.3rem;">Enter values in Lakhs (e.g., 50 for 50L, 150 for 1.5Cr)</small>
    </div>

    <!-- 3. Built Filters (Conditional) -->
    <div id="built-filters" class="filter-section hidden">
        <label class="filter-label">Configuration (BHK)</label>
        <div class="checkbox-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 1rem;">
            <label class="check-pill"><input type="checkbox" name="bhk" value="1 BHK"><span>1</span></label>
            <label class="check-pill"><input type="checkbox" name="bhk" value="2 BHK"><span>2</span></label>
            <label class="check-pill"><input type="checkbox" name="bhk" value="3 BHK"><span>3</span></label>
            <label class="check-pill"><input type="checkbox" name="bhk" value="4"><span>4+</span></label>
        </div>

        <label class="filter-label">Amenities</label>
        <div class="checkbox-grid">
            <label class="check-pill"><input type="checkbox" name="amenity" value="Pool"><span>Pool</span></label>
            <label class="check-pill"><input type="checkbox" name="amenity" value="Gym"><span>Gym</span></label>
            <label class="check-pill"><input type="checkbox" name="amenity" value="Garden"><span>Garden</span></label>
            <label class="check-pill"><input type="checkbox" name="amenity" value="Parking"><span>Parking</span></label>
        </div>
    </div>

    <!-- 4. Land Filters (Conditional) -->
    <div id="land-filters" class="filter-section hidden">
        <label class="filter-label">Plot Size (sq ft)</label>
        <div class="input-group" style="margin-bottom: 1rem;">
            <input type="number" id="areaMin" placeholder="Min SqFt">
            <input type="number" id="areaMax" placeholder="Max SqFt">
        </div>

        <label class="filter-label">Land Features</label>
        <div class="checkbox-grid">
            <label class="check-pill"><input type="checkbox" name="landFeat" value="Corner"><span>Corner</span></label>
            <label class="check-pill"><input type="checkbox" name="landFeat" value="Borewell"><span>Borewell</span></label>
            <label class="check-pill"><input type="checkbox" name="landFeat" value="Gated"><span>Gated</span></label>
            <label class="check-pill"><input type="checkbox" name="landFeat" value="Wall"><span>Wall</span></label>
        </div>
    </div>

    <button class="filter-btn" style="background:var(--primary); color:white; width:100%; padding: 1rem;" onclick="applyFilters()">Apply Filters</button>
</div>

<script>
    // --- Mock Data (Enriched for filtering demo) ---
    const mockData = [
        { 
            id: 101, 
            title: "Luxury Villa", 
            price: "‚Çπ 2.5 Cr", 
            location: "Whitefield, Bangalore", 
            type: "Built", 
            bhk: "4 BHK", 
            amenities: ["Pool", "Garden", "Parking", "Gym"],
            image: "https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&w=500&q=80", 
            contact: { phone: "+91 99999 88888", type: "Broker" },
            description: "Spacious villa in gated community with all amenities."
        },
        { 
            id: 102, 
            title: "Corner Plot", 
            price: "‚Çπ 60 Lakhs", 
            location: "Sarjapur Road, Bangalore", 
            type: "Land", 
            landArea: "1200",
            features: ["Corner", "Borewell", "Gated"],
            image: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=500&q=80", 
            contact: { phone: "+91 77777 66666", type: "Owner" },
            description: "Ready to build corner plot, east facing."
        },
        { 
            id: 103, 
            title: "City Apartment", 
            price: "‚Çπ 85 Lakhs", 
            location: "Indiranagar, Bangalore", 
            type: "Built", 
            bhk: "2 BHK", 
            amenities: ["Parking", "Lift"],
            image: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=500&q=80", 
            contact: { phone: "+91 88888 55555", type: "Broker" },
            description: "Walking distance to Metro, semi-furnished."
        }
    ];

    let properties = [];
    let currentIndex = 0;

    // Load Data
    function loadProperties(filteredList = null) {
        if (filteredList) {
            properties = filteredList;
        } else {
            const stored = JSON.parse(localStorage.getItem('property_db') || "[]");
            properties = [...stored, ...mockData];
        }
        currentIndex = 0;
        renderCard();
    }

    function renderCard() {
        const stack = document.getElementById('stack');
        const empty = document.getElementById('emptyState');

        // Clear existing card
        const existing = document.querySelector('.property-card');
        if(existing) existing.remove();

        if (currentIndex >= properties.length) {
            empty.style.display = 'block';
            return;
        }
        empty.style.display = 'none';

        const prop = properties[currentIndex];
        
        // Image logic
        const bgImage = prop.image || (prop.type === 'Land' 
            ? 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=500&q=80' 
            : 'https://images.unsplash.com/photo-1580587771525-78b9dba3b91d?auto=format&fit=crop&w=500&q=80');

        const card = document.createElement('div');
        card.className = 'property-card';
        card.innerHTML = `
            <div class="card-image" style="background-image: url('${bgImage}')">
                <div class="verified-badge">Verified</div>
                <div class="price-badge">${prop.price}</div>
            </div>
            <div class="card-details">
                <div>
                    <div class="prop-title">${prop.title}</div>
                    <div class="prop-loc">üìç ${prop.location}</div>
                    <div class="prop-tags">
                        <span class="tag">${prop.type}</span>
                        ${prop.bhk ? `<span class="tag">${prop.bhk}</span>` : ''}
                        ${prop.landArea ? `<span class="tag">${prop.landArea} sq ft</span>` : ''}
                    </div>
                </div>
                <div style="color:var(--text-muted); font-size:0.9rem; margin-top:1rem; line-height: 1.4;">
                    ${prop.description || 'No description available.'}
                </div>
            </div>
        `;
        stack.appendChild(card);
    }

    function swipe(direction) {
        const card = document.querySelector('.property-card');
        if(!card) return;

        const translate = direction === 'left' ? '-150%' : '150%';
        const rotate = direction === 'left' ? '-20deg' : '20deg';
        card.style.transform = `translate(${translate}, 0) rotate(${rotate})`;
        card.style.opacity = '0';

        if (direction === 'right') {
            showMatch(properties[currentIndex]);
        } else {
            setTimeout(() => {
                currentIndex++;
                renderCard();
            }, 300);
        }
    }

    function showMatch(prop) {
        const modal = document.getElementById('matchModal');
        document.getElementById('contactNumber').textContent = prop.contact.phone || "Not Listed";
        document.getElementById('contactType').textContent = prop.contact.type || "Seller";
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('matchModal').style.display = 'none';
        currentIndex++;
        renderCard();
    }

    // --- Filter Logic ---

    function toggleFilters() {
        document.getElementById('filterPanel').classList.toggle('open');
    }

    function toggleFilterSections() {
        const type = document.getElementById('filterType').value;
        const built = document.getElementById('built-filters');
        const land = document.getElementById('land-filters');
        
        built.classList.add('hidden');
        land.classList.add('hidden');

        if(type === 'Built') built.classList.remove('hidden');
        if(type === 'Land') land.classList.remove('hidden');
    }

    // Parse "‚Çπ 2.5 Cr" or "‚Çπ 80 Lakhs" to lakhs (number)
    function parsePriceToLakhs(priceStr) {
        if(!priceStr) return 0;
        let p = priceStr.toLowerCase().replace(/,/g, '');
        let val = parseFloat(p.match(/[\d\.]+/));
        if(!val) return 0;

        if(p.includes('cr')) return val * 100;
        return val; // Assume lakhs by default or if stated
    }

    function applyFilters() {
        const stored = JSON.parse(localStorage.getItem('property_db') || "[]");
        const allData = [...stored, ...mockData];

        // 1. Get Filter Values
        const type = document.getElementById('filterType').value;
        const loc = document.getElementById('filterLoc').value.toLowerCase();
        const minP = parseFloat(document.getElementById('priceMin').value) || 0;
        const maxP = parseFloat(document.getElementById('priceMax').value) || 99999;
        
        // 2. Filter
        const filtered = allData.filter(p => {
            // Type
            if (type !== 'All' && !p.type.includes(type)) return false;
            
            // Location
            if (loc && !p.location.toLowerCase().includes(loc)) return false;

            // Price
            const priceInLakhs = parsePriceToLakhs(p.price);
            if (priceInLakhs < minP || priceInLakhs > maxP) return false;

            // Built Specifics
            if (type === 'Built' && p.type.includes('Built')) {
                // BHK
                const bhkChecks = Array.from(document.querySelectorAll('input[name="bhk"]:checked')).map(c => c.value);
                if (bhkChecks.length > 0) {
                    const match = bhkChecks.some(b => p.bhk && p.bhk.includes(b));
                    // Handle "4+" logic simplistically
                    if(!match && bhkChecks.includes('4') && parseInt(p.bhk) >= 4) return true;
                    if(!match) return false;
                }
                
                // Amenities
                const amChecks = Array.from(document.querySelectorAll('input[name="amenity"]:checked')).map(c => c.value);
                if (amChecks.length > 0) {
                    // Check if property amenities (array or string) includes selected
                    if (!p.amenities) return false; 
                    const pAm = Array.isArray(p.amenities) ? p.amenities : [p.amenities];
                    const hasAll = amChecks.every(req => pAm.some(avail => avail.includes(req)));
                    if (!hasAll) return false;
                }
            }

            // Land Specifics
            if (type === 'Land' && p.type.includes('Land')) {
                // Area
                const minA = parseFloat(document.getElementById('areaMin').value) || 0;
                const maxA = parseFloat(document.getElementById('areaMax').value) || 999999;
                const pArea = parseFloat(p.landArea) || 0;
                if (pArea < minA || pArea > maxA) return false;

                // Features
                const featChecks = Array.from(document.querySelectorAll('input[name="landFeat"]:checked')).map(c => c.value);
                if (featChecks.length > 0) {
                     if (!p.features) return false;
                     const pFeat = Array.isArray(p.features) ? p.features : [p.features];
                     const hasAll = featChecks.every(req => pFeat.some(avail => avail.includes(req)));
                     if (!hasAll) return false;
                }
            }

            return true;
        });

        loadProperties(filtered);
        toggleFilters();
    }

    function resetFilters() {
        // Reset Inputs
        document.getElementById('filterType').value = 'All';
        document.getElementById('filterLoc').value = '';
        document.getElementById('priceMin').value = '';
        document.getElementById('priceMax').value = '';
        document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
        
        toggleFilterSections();
        loadProperties(null); // Reload all
    }

    // Init
    loadProperties();

</script>

</body>
</html>